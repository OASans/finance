# 定期调整

## stock_least_position

* 语法：
  
  * stock_least_position(stock_code: str) -> int
  
* 输入：
  
  * stock_code: 股票代码。
  
* 输出：
  
  * int, 用户设定的最少持仓股票数。
  
* 说明：

  - 返回用户某支股票的最少持仓数。

  - 或许需要访问系统其它地方的数据库（用户指定的最少持仓）。

## stock_volatility

- 语法：
  - stock_volatility(stock_code: str, time: int) -> float
-  输入：
  - stock_code: 股票代码。
  - time: 波动率的时间周期，可以是1, 7, 30，代表当日，近一周，近一月。
- 输出：
  - float, 股票在`time`周期下的波动率。
- 说明：
  - 返回该股票在指定时间周期下的波动率。
  - 或许需要访问系统其它地方的功能接口（波动率计算）。

## stock_change

- 语法：
  - stock_change(stock_code: str, time: int) -> float
- 输入：
  - stock_code: 股票代码。
  - time: 涨跌幅的时间周期，可以是1, 7, 30，代表当日，近一周，近一月。
- 输出：
  - float, 股票在`time`周期下的涨跌幅。
- 说明：
  - 返回该股票在指定时间周期下的涨跌幅。
  - 或许需要访问外部网站的数据（涨跌幅）。

## stock_mean_return

- 语法：
  - stock_mean_return(stock_code: str, time: int) -> float
- 输入：
  - stock_code: 股票代码
  - time: 平均收益率的时间周期，可以是1, 7, 30，代表当日，近一周，近一月。
- 输出：
  - float, 股票在`time`周期下的平均收益率
- 说明：
  - 返回该股票在指定时间周期下的平均收益率。
  - 或许需要访问系统其它地方的功能接口（平均收益率计算）。

## portfolio_var

见投资组合类的调整和触发。

## portfolio_volatility

见投资组合类的调整和触发。

## portfolio_diff

见投资组合类的调整和触发。

# 条件触发

## stock_least_position

见定期调整部分的说明。

## stock_volatility

见定期调整部分的说明。

## stock_change

见定期调整部分的说明。

## stock_mean_return

见定期调整部分的说明。

## stock_turnover_rate

- 语法：
  - stock_turnover_rate(stock_code: str) -> float
- 输入：
  - stock_code: 股票代码。
- 输出：
  - float, 股票在当天的换手率。
- 说明：
  - 返回该股票最近一日的换手率。
  - 或许需要访问外部网站的数据（换手率）。

## stock_macd

- 语法：
  - stock_macd(ts_code: str) -> Series, float
- 输入：
  - ts_code: 股票的ts代码。
- 输出：
  - Series, 股票历史的macd序列(最后一项是当日)
  - float, 股票当日的macd指数。
- 说明：
  - 根据最近26日的收盘价，计算出指数平滑移动平均线（Moving Average Convergence and Divergence，简称MACD）。
  - 需要调用talib库。
  - 或许需要访问外部网站的数据（近期26日收盘价）。

## stock_rsi

- 语法：
  - stock_rsi(ts_code: str) -> Series, Series, Series, dict
- 输入：
  - ts_code: 股票的ts代码。
- 输出：
  - Series, 股票历史6日RSI序列
  - Series, 股票历史12日RSI序列
  - Series, 股票历史24日RSI序列
  - dict, 包含三个key：'rsi6', 'rsi12', 'rsi24'，对应的value均为float。分别为股票当日的6日、12日、24日相对强弱指数RSI。
- 说明：
  - 根据最近24日的收盘价，计算6日、12日、24日的相对强弱指数RSI
  - 需要调用talib库。
  - 或许需要访问外部网站的数据（近期24日收盘价）。
  
## stock_mom

- 语法：
  - stock_mom(ts_code: str) -> Series, float
- 输入：
  - ts_code: 股票的ts代码。
- 输出：
  - Series, 股票历史动量序列
  - mom: float, 股票当日动量的数值。
- 说明：
  - 根据最近5日的收盘价，计算股票动量
  - 或许需要访问外部网站的数据（近期5日收盘价）。

## stock_kdj

- 语法：
  - stock_kdj(stock_code: str) -> dict
- 输入：
  - ts_code: 股票的ts代码。
- 输出：
  - Series, 股票历史K序列
  - Series, 股票历史D序列
  - Series, 股票历史J序列
  - dict, 包含三个key：'K', 'D', 'J'，对应的value均为float。三个值分别为随机指标中的K, D, J。
- 说明：
  - 根据最近9日的收盘价，计算随机指标中的K, D, J值。
  - 或许需要访问外部网站的数据（近期9日收盘价）。

## stock_roc

- 语法：
  - stock_roc(stock_code: str, N: int) -> float
- 输入：
  - ts_code: 股票的ts代码。
  - N: 指定与多少天前的收盘价比较。
- 输出：
  - float, 变动率指标ROC。
- 说明：
  - 根据指定的N，比较本日和N日前的收盘价，返回变动率。
  - 这个功能和stock_change完全相同，因此是调用了stock_change。
  - 或许需要访问外部网站的数据（近期N日收盘价）。

## stock_sharpe

- 语法：
  - stock_sharpe(ts_code: str, N: int, r: float) -> float
- 输入：
  - ts_code: 股票的ts代码。
  - N: 计算夏普率的时间周期，可以是1, 7, 30，代表当日，近一周，近一月。
  - r: 无风险收益率，一般取SHIBOR(3M) 
- 输出：
  - float, 夏普比的数值。
- 说明：
  - 以日收益率为标准，返回股票的夏普比。
  - 或许需要访问外部网站的数据（日收益率）。

## portfolio_var

见投资组合类的调整和触发。

## portfolio_volatility

见投资组合类的调整和触发。

## portfolio_diff

见投资组合类的调整和触发。



# 投资组合类的调整和触发

## 输入说明

由于投资组合类是多种股票的集合，因此约定投资组合的输入如下：

* 输入对象是一个`list`，储存float数据，代表投资组合在不同时间的价值。
* 价值的计算方法是：$\sum 该股票的持有量 \times 该股票的单位价格$

如，投资组合为30份A股票，50份B股票，A股票在T日的单位价值为10，B股票相应单位价值为8，则投资组合在T日的价值为：
$$
30\times10+50\times 8 = 700
$$


## portfolio_var

- 语法：
  - portfolio_var(price: list) -> float
- 输入：
  - price: 投资组合的历史价值
- 输出：
  - float, var的数值
- 说明：
  - 计算投资组合的VaR。
  - 需要计算投资组合的价值。

## portfolio_volatility

这个函数需要返回的是投资组合的波动率，供期权/期货进行调整。只需要将投资组合作为输入，调用波动率计算的模块即可。代码中仅供参考。

## portfolio_diff

这个函数需要的是返回调整后的组合之delta值与推荐的delta值之差，只涉及简单的数值比较，不再另外设计函数，考虑如何获取delta即可。

# 补充说明

* 对于需要访问外部数据库（如收盘价）或者其他指标（如收益率）的计算函数，实现时会调用一个临时的获取函数，如果数据在系统内已有缓存而不用向外部获取，到时候修改获取函数即可。
* 股票代码如无特殊说明，都是ts格式：'000001.SH'